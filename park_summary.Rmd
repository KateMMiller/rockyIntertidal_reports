---
output:
  html_document:
    css: www/styles.css
    anchor_sections: FALSE
    includes:
      in_header: "header_manual.html"

params:
  year_curr: 2021
  park: "ACAD"
  all_years: TRUE # If FALSE, only reports on year_curr; TRUE reports on all years; Not enabled yet
---

```{r setup, include = F}
knitr::opts_chunk$set(echo = FALSE)
options(knitr.kable.NA = '', scipen = 100)
#knitr::opts_chunk$set(fig.width=12, fig.height=10) 
```

```{r imports, include = FALSE}
library(rockyIntertidal)
library(tidyverse)
library(grid)
library(knitr)
library(DT)
library(plotly)
library(htmltools)
library(DiagrammeR)
```

```{r imports2, include = FALSE, cache = T}
importData()
path = "../data/rocky/temp_data/Compiled_HT_water_temps/"
importWaterTemp(path = path, simplify = T, buoy = T)
```

```{r params, include = FALSE}
park = "ACAD"
year_curr = 2021
years = 2013:2021

run = TRUE # using for testing, so don't have to wait forever for full report to knit, when
# just testing 1 section. run = FALSE only runs the chunks set to eval = TRUE; 

park = params$park
year_curr = params$year_curr
years = if(params$all_years == TRUE){2013:year_curr} else {year_curr}

# Set up args list
arglist <- list(park = park, years = years)

locs <- do.call(getPIBoltDistance, arglist) |>
  select(Loc_Code) |> arrange(Loc_Code) |> unique() |> c() #|> as.character()

trans_species <- do.call(getPISpecies, arglist) |> 
  select(Spp_Code) |> arrange(Spp_Code) |> unique() |> 
  filter(!Spp_Code %in% c("BOLT", "ROCK", "WATER", NA, "OTHSUB", "OTHINV", "UNIDEN")) |> 
  c()

trans_species_com <- switch(park, 
                            "ACAD" = c("ALGGRE", "ALGRED", "ARTCOR", "ASCEPI", "ASCNOD", "BARSPP", 
                                      "CHOMAS", "CRUCOR", "FUCEPI", "FUCSPP", "MUSSPP", "ULVLAC"),
                            "BOHA" = c("ALGGRE", "ALGRED", "ASCEPI", "ASCNOD", "BARSPP", 
                                       "CHOMAS", "FUCEPI", "FUCSPP", "ULVLAC")
                       )

```

Rocky intertidal data summary for `r params$park` and `r paste(years, collapse = ", ")` {.tabset .tabset-pills}
---

```{r, warning = FALSE, message = FALSE, results = 'hide', include = FALSE, eval = run}
#---- Plotting all species by elevation per location -----
trans_species_plots <- 
  purrr::map(locs$Loc_Code,
             ~plotPISpecies(location = ., xlab = "Year", ylab = "Elevation MLLW (m)", species = 'all',
                                    title = TRUE, facet = TRUE, years = years, rev_axis = F) +
    theme(legend.position = 'bottom',
          legend.text = element_text(size = 10),
          legend.key.size = unit(0.5, 'cm'),
          legend.key.width = unit(0.5, 'cm'),
          legend.key.height = unit(0.5, 'cm'),
          legend.title = element_blank()))
```
```{r, warning = FALSE, message = FALSE, results = 'hide', include = FALSE, eval = run}
#---- Plotting individual PI transect species across all locations -----
trans_species_plots_park <- 
  purrr::map(trans_species_com, 
             ~ plotPISpecies(park = park, location = 'all', xlab = 'Year', ylab = "Elevation MLLW (m)",
                                     species = ., title = FALSE, facet = TRUE, years = years, rev_axis = F))
```
```{r, warning = FALSE, message = FALSE, results = 'hide', include = FALSE, eval = run}
#---- Plotting main 5 species for PI transects with plotly -----
trans_spp_plotly <- plotPISpecies(park = park, years = years, title = F, xlab = NULL, #facet = F,
                      species = 'all', main_groups = T, rev_axis = F, plotly = T, ribbon = T)
```
```{r, warning = FALSE, message = FALSE, results = 'hide', include = FALSE, eval = run}
#---- Plotting photoplot cover by target species and site ----
photo_species_plots <- purrr::map(locs$Loc_Code,
  ~plotPhotoCover(location = ., species = 'all', top_spp = 3, years = years)                                
  )
```
```{r, warning = FALSE, message = FALSE, results = 'hide', include = FALSE, eval = run}
#---- Plotting individual photoplot target species across all locations
targ_spp <- switch(park, 
                   "ACAD" = c("Barnacle", "Fucus", "Ascophyllum", "Red Algae", "Mussel"),
                   "BOHA" = c("Barnacle", "Fucus", "Ascophyllum", "Red Algae"))
                   
```
```{r, warning = FALSE, message = FALSE, results = 'hide', include = FALSE, eval = run}
photo_species_plots_park <- purrr::map(targ_spp,
  ~plotPhotoCover(park = park, location = 'all', target_species = ., 
                  top_spp = 3, species = 'all', years = years)                                
  )

```
```{r, warning = FALSE, message = FALSE, results = 'hide', include = FALSE, eval = run}
photo_species_heatmap <- purrr::map(locs$Loc_Code,
  ~plotPhotoCover(park = park, location = ., heatmap = TRUE, main_groups = T, years = years))

```

```{r, contour_chunk, warning = FALSE, message = FALSE, eval = FALSE}
plotSpeciesContours(location = loc, years = years, plot_title = F)
```

### Site Contours {.tabset}
```{r warning = FALSE, message = FALSE, results = 'asis', fig.height = 9, out.width = "160%", eval = run}
for(i in seq_along(locs$Loc_Code)){
  loc <- locs$Loc_Code[[i]]
  cat("#### ", loc, "\n\n")
  cat("Smoothed site contours based on bolt elevation and transect distances averaged over all years. Species points represent point intercept detections for each of the 5 main species across the three point intercept transects per year. Symbols represent the median elevation for a species per year. Pie charts represent the median percent cover by species and median elevation across photoplots for each year. The five main species are: BARSPP, MUSSPP, ASCNOD, FUCSPP, and combined Red algae group.\n")
  cat("\n\n")
  <<contour_chunk>>
  cat("\n\n")
  cat("\n\n")

}
```

#### Data {.tabset}
```{r echo = F, include = F, eval = run}
# Generating the data that feeds into the contour plots
photo1 <- suppressWarnings(getPhotoCover(park = park, plotName = 'all',
                                         category = 'all', years = years, QAQC = FALSE,
                                         species = c("ASCNOD",  "ASCEPI", "BARSPP",
                                                     "FUCSPP", "FUCEPI",
                                                     "MUSSPP", "ALGRED", "CHOMAS"),
                                         target_species = 'all')) |>
                           dplyr::filter(!is.na(Perc_Cover))

photo <- photo1 |> mutate(Spp_Code = case_when(Spp_Code %in% c("ALGRED", "CHOMAS") ~ "REDGRP",
                                               Spp_Code %in% c("FUCSPP", "FUCEPI") ~ "FUCSPP",
                                               Spp_Code %in% c("ASCNOD", "ASCEPI") ~ "ASCNOD",
                                               TRUE ~ Spp_Code),
                          Spp_Name = case_when(Spp_Code %in% "REDGRP" ~ "Red algae group",
                                               Spp_Code %in% "FUCSPP" ~ "Fucus spp. (Rockweed)",
                                               Spp_Code %in% "ASCNOD" ~ "A. nodosum (knotted wrack)",
                                               TRUE ~ Spp_Name))

# combine cover for red group
photo_sum1 <- photo |> group_by(Site_Code, Loc_Code, Year, Spp_Code, Plot_Name,
                                Target_Species, Bolt_MLLW_Elev) |>
                       summarize(tot_cov = sum(Perc_Cover, na.rm = T),
                                .groups = 'drop') |> ungroup()

# summarize median cover
photo_sum <- photo_sum1 |> group_by(Site_Code, Loc_Code, Year, Target_Species, Spp_Code) |>
                           summarize(avg_cover = mean(tot_cov, na.rm = T),
                                     med_cover = median(tot_cov, na.rm = T),
                                     elev = median(Bolt_MLLW_Elev, na.rm = T),
                                     .groups = 'drop')

# Compile species PI data
spdat1 <- suppressWarnings(sumPISpecies(park = park, plotName = 'all',
                                        years = years,
                                        QAQC = FALSE,
                                        species = c("ASCNOD", "BARSPP", "FUCSPP",
                                                    "MUSSPP", "ALGRED", "CHOMAS")))

# Combine ALGRED and CHOMAS
spdat <- spdat1 |> mutate(Spp_Code = ifelse(Spp_Code %in% c("ALGRED", "CHOMAS"), "REDGRP", Spp_Code),
                          Spp_Name = ifelse(Spp_Code %in% "REDGRP", "Red algae group", Spp_Name))

trdat <- spdat |> select(Site_Code, Loc_Code, #Year, Plot_Name,
                         elev = PI_Elevation, dist = PI_Distance) |> #dist = Distance_m) |>
                    unique() |> na.omit()
locs1 <- unique(spdat$Loc_Code)

# Smooth contours across all transects and years
trsm <- purrr::map_dfr(seq_along(locs1), 
     function(loc){
       loccode <- locs1[loc]
       dat <- trdat |> filter(Loc_Code == loccode)                  
       smooth <- loess(dist ~ elev, data = dat, span = 0.6)
       cbind(dat, dist_pred = predict(smooth, dat))
})

# Predict distance for photo plots
photo_dist <- purrr::map_dfr(seq_along(locs1), 
     function(loc){
       loccode <- locs1[loc]
       datsm <- trdat |> filter(Loc_Code == loccode)                  
       smooth <- loess(dist ~ elev, data = datsm, span = 0.6)
       photosm <- photo_sum |> filter(Loc_Code == loccode)
       cbind(photosm, dist_pred = predict(smooth, photosm))
})
    
  # Red algae photo plots are sometimes lower elevation than the transect, and loess smoother
  # won't predict a distance value for those elevations. Replacing NA with farthest distance in trsm_dat
  # SHIHAR Ascophyllum photoplots are higher than the transect elevations. Adjusting by changing the max
  # elevation for Ascophyllum to be close to median of Asco point intercepts from 2013
  max_dist <- trsm |> group_by(Loc_Code) |> summarize(max_dist = max(dist_pred, na.rm = T))
  shidist <- 0.553

  photo_dist2 <- left_join(photo_dist, max_dist, by = "Loc_Code")
  
  photo_dist2 <- photo_dist2 |> 
    mutate(dist_pred = ifelse(is.na(dist_pred) & Target_Species == "Red Algae", max_dist, 
                              ifelse(is.na(dist_pred) & Target_Species == "Ascophyllum" &
                                       Loc_Code == "SHIHAR", 0.533, dist_pred))) |> select(-max_dist)
  
  photo_dist_wide <- photo_dist2 |> select(Site_Code, Loc_Code, Year, Target_Species,
                                          Spp_Code, avg_cover, elev, dist_pred) |>
                                   pivot_wider(names_from = Spp_Code,
                                               values_from = avg_cover, values_fill = 0)

  # Summarize species PIs, then predict distance from elevations
  sp_sum <- spdat |> group_by(Site_Code, Loc_Code, Year, Spp_Code, Spp_Name) |>
    summarize(elev_min = min(PI_Elevation, na.rm = T),
              elev_max = max(PI_Elevation, na.rm = T),
              elev_med = median(PI_Elevation, na.rm = T),
              elev_l95 = quantile(PI_Elevation, probs = 0.025, na.rm = T),
              elev_u95 = quantile(PI_Elevation, probs = 0.975, na.rm = T),
              elev_l25 = quantile(PI_Elevation, probs = 0.25, na.rm = T),
              elev_u75 = quantile(PI_Elevation, probs = 0.75, na.rm = T),
              .groups = 'drop')

  # Create new datasets for prediction for each stat
  sp_min <- sp_sum |> select(Site_Code:Spp_Name, elev = elev_min)
  sp_med <- sp_sum |> select(Site_Code:Spp_Name, elev = elev_med)
  sp_max <- sp_sum |> select(Site_Code:Spp_Name, elev = elev_max)
  sp_l25 <- sp_sum |> select(Site_Code:Spp_Name, elev = elev_l25)
  sp_u75 <- sp_sum |> select(Site_Code:Spp_Name, elev = elev_u75)

  # Predict distances for each stat based on its elevation
  sp_dist <- purrr::map_dfr(seq_along(locs1), 
     function(loc){
       loccode <- locs1[loc]
       datsm <- trdat |> filter(Loc_Code == loccode)                  
       smooth <- loess(dist ~ elev, data = datsm, span = 0.6)
       spsmooth <- sp_sum |> filter(Loc_Code == loccode) |> select(Site_Code:Spp_Name, elev = elev_med)
       cbind(spsmooth, dist_pred = predict(smooth, spsmooth))
  })
```  
```{r echo = F, include = F, eval = run}  
raw_photo_dt <- datatable(photo1, width = '1200px', 
                          extensions = c("FixedColumns", "Buttons"),
                          options = list(       
                             pageLength = 100,
                             autoWidth = FALSE, scrollX = TRUE,
                             scrollY = '600px',
                             scrollCollapse = TRUE,
                             fixedColumns = list(leftColumns = 1),
                             dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                          filter = list(position = c('top'), clear = FALSE))

```
```{r echo = F, include = F, eval = run}
sum_photo_dt <- datatable(photo_sum, width = '1200px', 
                       extensions = c("FixedColumns", "Buttons"),
                       options = list(       
                           pageLength = 100,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                        filter = list(position = c('top'), clear = FALSE))
```
```{r echo = F, include = F, eval = run}
raw_PIspecies_dt <- 
  datatable(spdat1, width = '1200px',
            extensions = c("FixedColumns", "Buttons"),
            options = list(       
                           pageLength = 100,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
            filter = list(position = c('top'), clear = FALSE)
            ) 

```
```{r echo = F, include = F, eval = run}
sum_PIspecies_dt <- 
  datatable(sp_dist, width = '1200px',
            extensions = c("FixedColumns", "Buttons"),
            options = list(       
                           pageLength = 100,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                      filter = list(position = c('top'), clear = FALSE))
```
```{r echo = F, include = F, eval = run}
photocov <- getPhotoCover(park = park, years = years) |> 
  group_by(Loc_Code, Year, Target_Species) |> 
  summarize(num_records = n(), .groups = 'drop') |> 
  pivot_wider(names_from = Target_Species, values_from = num_records, values_fill = 0)

phototab_dt <- datatable(photocov, width = '1200px',
            extensions = c("FixedColumns", "Buttons"),
            options = list(       
                           pageLength = 100,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                      filter = list(position = c('top'), clear = FALSE))
 
pispp <- getPISpecies(park = park, years = years) |> 
  group_by(Loc_Code, Year, Spp_Code) |> 
  summarize(num_records = n(), .groups = 'drop') |> 
  pivot_wider(names_from = Spp_Code, values_from = num_records, values_fill = 0)

pispp_dt <- datatable(pispp, width = "1200px",
                      extensions = c("FixedColumns", "Buttons"),
                      options = list(       
                           pageLength = 100,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                      filter = list(position = c('top'), clear = FALSE))

```

##### Raw Photo Data
Raw photoplot data
```{r, eval = run}

raw_photo_dt
```

##### Summarized Photo Data
Photoplot data summarized for pie charts
```{r, eval = run}
sum_photo_dt
```

##### Photoplot Table
Photoplot records by site, year, and target species (to show any missing data)
```{r, eval = run}
phototab_dt
```


##### Raw PI Species Data
Raw point intercept species data
```{r, eval = run}
raw_PIspecies_dt
```

##### Summarized PI Species Data
Point intercept data summarized for points on site contour
```{r, eval = run}
sum_PIspecies_dt
```

##### PI Species Table
PI species records by site and year (to show any missing data)
```{r, eval = run}
pispp_dt
```

### Point Intercept Transects {.tabset}

#### By Main Species {.tabset}
Point Intercept species by elevation across locations. Points are median elevation across 3 transects. 
Bands lower 25% and upper 75% distributions across 3 transects for the primary species of concern. In the legend, Ascophyllum nodosum (Knotted wrack) is abbreviated as ASCNOD, Barnacles are abbreviated as BARSPP, Fucus spp. (Rockweed) is abbreviated as FUCSPP, Mussels are abbreviated as MUSSPP, and red algae are abbreviated as REDGRP. The red algae group includes Irish moss (Chondrus / Mastocarpus) and algae identified as Other Algae - Red. 
```{r fig.height = 8, fig.width = 10, eval = run}
trans_spp_plotly
```

#### By Location {.tabset}
```{r warning = FALSE, message = FALSE, fig.height = 8, fig.width = 10, results = 'asis', eval = run}
for(i in seq_along(locs$Loc_Code)){
  loc <- locs$Loc_Code[[i]]
  cat("##### ", loc, "\n")
  cat("Point Intercept species by elevation. Points are median elevation across 3 transects. 
       Wider lines are the middle 25% and 75% quantiles. Thin lines are minimum and maximum elevations 
       recorded for a given species.", "\n")
  print(trans_species_plots[[i]])
  cat("\n\n") 
}
```

#### By Species {.tabset}
```{r warning = FALSE, message = FALSE, fig.height = 8, fig.width = 10, results = 'asis', eval = run}
for(i in seq_along(trans_species_com)){
  cat("##### ", trans_species_com[[i]], "\n")
  cat("Point Intercept species by elevation across locations. Points are median elevation across 3 transects.
      Wilder lines are the middle 25% and 75% quantiles. Thin lines are minimum and maximum elevations
      recorded for a given species.", "\n")
  print(trans_species_plots_park[[i]])
  cat("\n\n")
}
```

### Photoplots {.tabset}
#### Motile Inverts vs. Substrate Species {.tabset}

```{r motinv_chunk, results = 'hide', include = F, eval = T}
motinv_photo_plots <- list()
motinv_photo_plots <- purrr::map(locs$Loc_Code,
  function(loc){
  subp <-
     plotly::subplot(
       plotMotileInvertCounts(location = loc, main_groups = TRUE,
                              plotly = T, years = 2013:2018, xaxis = F),
       plotPhotoCover(location = loc, main_groups = T, plotly = T, years = 2013:2018),
       nrows = 2, margin = c(0.1, 0.05, 0.05, 0.05),
       shareY = FALSE, titleY = T, titleX = T
    ) |> layout(width = 900, height = 750)
    subp$x$layout$yaxis$title <- "Median Count"
    subp$x$layout$yaxis2$title <- "Median % Cover"
    subp
    }) |> set_names(locs$Loc_Code)
    
#assign("motinv_photo_plots", motinv_photo_plots, envir = .GlobalEnv)

```


```{r warning = FALSE, message = FALSE, out.height="90%", results = 'asis', eval = TRUE}

for(i in seq_along(locs$Loc_Code)){
  loc <- locs$Loc_Code[[i]]
  cat("##### ", loc, "\n")
  cat("Motile Invertebrate median counts and substrate species percent cover by target species group. 
       Points are median values (ie count or cover) across photoplots. Ribbons are lower 25% and upper 75%
       distribution. Substrate species only include main community species.", "\n\n")
  cat(knit_print(motinv_photo_plots[[loc]]))
  cat("\n\n") 
  cat("\n\n")
}
```
```{r include = F}
htmltools::tagList(motinv_photo_plots)
```

#### By Location {.tabset}
```{r warning = FALSE, message = FALSE, fig.height = 8, fig.width = 10, results = 'asis', eval = run}
for(i in seq_along(locs$Loc_Code)){
  cat("##### ", locs$Loc_Code[[i]], "\n")
  cat("Species percent cover by target species group. Points are median cover across photoplots. 
       Error bars are minimum and maximum cover recorded within a target species. Only top 3 species
       are plotted in each target species group, with tied species included.", "\n")
  print(photo_species_plots[[i]])
  cat("\n\n") 
}
```

#### By Target Species {.tabset}
```{r warning = FALSE, message = FALSE, fig.height = 8, fig.width = 10, results = 'asis', eval = run}
for(i in seq_along(targ_spp)){
  cat("##### ", targ_spp[[i]], "\n")
  cat("Species percent cover by target species group across all lcoations. Points are median cover across photoplots. 
       Error bars are minimum and maximum cover recorded within a target species. Only top 3 species
       are plotted in each target species group, with tied species included.", "\n")
  print(photo_species_plots_park[[i]])
  cat("\n\n") 
}
```

#### Heatmaps {.tabset}
```{r warning = FALSE, message = FALSE, fig.height = 8, fig.width = 12, results = 'asis', eval = run}
for(i in seq_along(locs$Loc_Code)){
  cat("##### ", locs$Loc_Code[[i]], "\n")
  cat("Median percent cover by target species group for main 5 species per photoplot target species. ", "\n")
  print(photo_species_heatmap[[i]])
  cat("\n\n") 
}
```


### Temperature Loggers {.tabset}
#### By Location {.tabset}
```{r loc_buoy, echo = F, eval = F, out.width = "100%", out.height = "60%", eval = run}
suppressWarnings(plotBuoyData(park = park, years = years, metric = 'all', facet_col = 1))
```

```{r loc_water, echo = F, eval = F, out.width = "100%", out.height = "40%", eval = run}
suppressWarnings(print(plotWaterTemp(park = park, location = loc, legend_position = 'none',
                                     years = years, facet = F, plotly = F, palette = 'greyscale')))
```

```{r warning = FALSE, message = FALSE, results = 'asis', eval = run}
for(i in seq_along(locs$Loc_Code)){
  loc = locs$Loc_Code[[i]]
  cat("##### ", loc, "\n\n")
  cat("Daily buoy statistics for ", park, ". Wind direction is the value recorded during the daily maximum wind speed. ", "\n\n", sep = "")
  <<loc_buoy>>
  cat("\n\n")
  cat("High tide water temperature (F) for ", loc, "\n\n")
  <<loc_water>>
  cat("\n\n")
} 
```

#### By Year {.tabset}
```{r year_buoy, echo = F, eval = F, out.width = "100%", eval = FALSE}
suppressWarnings(plotBuoyData(park = park, years = year, metric = 'all', facet_col = 1))
```

```{r year_water, echo = F, eval = F, out.width = "100%", eval = FALSE}
suppressWarnings(print(plotWaterTemp(park = park, location = loc, legend_position = "none",
                                     years = year, facet = F, plotly = F, palette = "greyscale")))
```

```{r results = 'asis', eval = run}
for(i in seq_along(years)){
  year = years[[i]]
  cat("##### ", year, "\n\n")
  cat("Daily buoy statistics for ", year, ". Wind direction is the value recorded during the daily maximum wind speed. ", "\n\n", sep = "")
  <<year_buoy>>
    cat("\n\n")
  cat("High tide water temperature (F) for ", year, " by site.", "\n\n")
    for(j in seq_along(locs$Loc_Code)){
      loc = locs$Loc_Code[[j]]
      cat("<details open><summary class = 'drop'>", loc, "</summary>")
      <<year_water>>
        cat("\n\n")
      cat("</details>", "\n\n")
    } 
  cat("\n\n")
} 
```

#### Data {.tabset}
##### Buoy
```{r echo = F, include = F, eval = run}
buoy_dt <- if(park == "ACAD"){
  datatable(get("ACAD_buoy", envir = ROCKY), width = '1200px',
            extensions = c("FixedColumns", "Buttons"),
            options = list(       
                           pageLength = 100,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                      filter = list(position = c('top'), clear = FALSE))
} else {
  datatable(get("BOHA_buoy", envir = ROCKY), width = '1200px',
            extensions = c("FixedColumns", "Buttons"),
            options = list(       
                           pageLength = 100,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                      filter = list(position = c('top'), clear = FALSE)) 
}
```
```{r warning = FALSE, eval = run}
suppressWarnings(buoy_dt)
```

##### Loggers
```{r echo = F, include = F, eval = run}
log_dt <- if(park == "ACAD"){
  log_dat <- rbind(ROCKY$BASHAR, ROCKY$LITHU, ROCKY$LITMOO, ROCKY$OTTPOI, ROCKY$SCHPOI, ROCKY$SHIHAR)
  datatable(log_dat, width = '1200px',
            extensions = c("FixedColumns", "Buttons"),
            options = list(       
                           pageLength = 10,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                      filter = list(position = c('top'), clear = FALSE))
} else {
    log_dat <- rbind(ROCKY$CALISL, ROCKY$GREISL, ROCKY$OUTBRE)
    datatable(log_dat, width = '1200px',
            extensions = c("FixedColumns", "Buttons"),
            options = list(       
                           pageLength = 10,
                           autoWidth = FALSE, scrollX = TRUE,
                           scrollY = '600px',
                           scrollCollapse = TRUE,
                           fixedColumns = list(leftColumns = 1),
                           dom = "Blfrtip", buttons = c('copy', 'csv', 'print')),
                      filter = list(position = c('top'), clear = FALSE))
}
```

```{r warning = F, eval = run}
suppressWarnings(log_dt)
```

